<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - StockMaster</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.5;
        }
        .container {
            display: flex;
            min-height: 100vh;
        }
        #sidebar {
            width: 260px;
            background: var(--card);
            box-shadow: 1px 0 0 var(--border);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }
        .main-content {
            margin-left: 260px;
            flex: 1;
            padding: 32px 40px;
            max-width: 1400px;
        }
        .page-header {
            margin-bottom: 32px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 24px;
        }
        .page-header h1 {
            font-size: 32px;
            font-weight: 400;
            color: var(--text);
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }
        .page-header p {
            color: var(--muted);
            font-size: 14px;
            font-weight: 400;
        }
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        .kpi-card {
            background: var(--card);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border: 1px solid var(--border);
        }
        .kpi-card:hover {
            box-shadow: 0 10px 24px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }
        .kpi-card h3 {
            font-size: 13px;
            color: var(--muted);
            margin-bottom: 16px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .kpi-card .value {
            font-size: 36px;
            font-weight: 400;
            color: var(--text);
            margin-bottom: 4px;
            line-height: 1.2;
        }
        .kpi-card .icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            font-size: 24px;
            background: rgba(26, 115, 232, 0.08);
        }
        .filters-section {
            background: var(--card);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
            margin-bottom: 32px;
            border: 1px solid var(--border);
        }
        .filters-section h2 {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 20px;
            color: var(--text);
            letter-spacing: -0.2px;
        }
        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        .filter-group label {
            font-size: 13px;
            color: var(--muted);
            margin-bottom: 8px;
            font-weight: 500;
        }
        .filter-group select {
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            background: var(--card);
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text);
        }
        .filter-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.12);
        }
        .btn-primary {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
        }
        .btn-primary:hover {
            background: var(--primary-hover);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.16);
        }
        .clock-widget {
            background: linear-gradient(135deg, #1A73E8 0%, #185ABC 100%);
            border-radius: 12px;
            padding: 20px 24px;
            box-shadow: 0 4px 12px rgba(26, 115, 232, 0.2), 0 2px 4px rgba(0, 0, 0, 0.1);
            color: white;
            min-width: 200px;
            text-align: center;
        }
        .clock-time {
            font-size: 32px;
            font-weight: 300;
            letter-spacing: 1px;
            margin-bottom: 4px;
            font-variant-numeric: tabular-nums;
        }
        .clock-date {
            font-size: 13px;
            opacity: 0.9;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .widgets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        .widget-card {
            background: var(--card);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
            border: 1px solid var(--border);
            transition: all 0.2s ease;
        }
        .widget-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);
            transform: translateY(-2px);
        }
        .widget-card h3 {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 16px;
            color: var(--text);
            letter-spacing: -0.2px;
        }
        .recent-activity {
            list-style: none;
        }
        .recent-activity li {
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .recent-activity li:last-child {
            border-bottom: none;
        }
        .activity-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }
        .activity-content {
            flex: 1;
        }
        .activity-content p {
            margin: 0;
            font-size: 14px;
            color: var(--text);
        }
        .activity-content span {
            font-size: 12px;
            color: var(--muted);
        }
        .stats-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 16px;
        }
        .stat-item {
            text-align: center;
            padding: 12px;
            background: rgba(0, 0, 0, 0.04);
            border-radius: 8px;
        }
        .stat-item .value {
            font-size: 24px;
            font-weight: 500;
            color: var(--text);
            margin-bottom: 4px;
        }
        .stat-item .label {
            font-size: 11px;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .charts-section {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 32px;
        }
        .chart-card {
            background: var(--card);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
            border: 1px solid var(--border);
            transition: all 0.2s ease;
        }
        .chart-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);
            transform: translateY(-2px);
        }
        .chart-header {
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }
        .chart-header h3 {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 4px;
            color: var(--text);
            letter-spacing: -0.2px;
        }
        .chart-subtitle {
            font-size: 12px;
            color: var(--muted);
        }
        .chart-container {
            min-height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }
        .widget-header h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 500;
            color: var(--text);
            letter-spacing: -0.2px;
        }
        .alert-badge, .notification-badge {
            background: #D32F2F;
            color: white;
            font-size: 11px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 12px;
            min-width: 20px;
            text-align: center;
        }
        .notification-badge {
            background: var(--primary);
        }
        .top-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }
        .top-item:last-child {
            border-bottom: none;
        }
        .top-item-rank {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            background: rgba(26, 115, 232, 0.1);
            color: #1A73E8;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            flex-shrink: 0;
        }
        .top-item-content {
            flex: 1;
        }
        .top-item-content p {
            margin: 0 0 2px 0;
            font-size: 14px;
            color: var(--text);
            font-weight: 500;
        }
        .top-item-content span {
            font-size: 12px;
            color: var(--muted);
        }
        .top-item-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
        }
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        .quick-action-btn {
            padding: 16px;
            background: rgba(26, 115, 232, 0.05);
            border: 1px solid rgba(26, 115, 232, 0.1);
            border-radius: 8px;
            text-decoration: none;
            color: #1A73E8;
            text-align: center;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        .quick-action-btn:hover {
            background: rgba(26, 115, 232, 0.1);
            border-color: #1A73E8;
            transform: translateY(-2px);
        }
        .quick-action-btn .icon {
            font-size: 24px;
        }
        .quick-action-btn .text {
            font-size: 12px;
            font-weight: 500;
        }
        .notification-item {
            padding: 12px;
            background: rgba(26, 115, 232, 0.05);
            border-left: 3px solid #1A73E8;
            border-radius: 6px;
            margin-bottom: 8px;
        }
        .notification-item.alert {
            background: rgba(211, 47, 47, 0.05);
            border-left-color: #D32F2F;
        }
        .notification-item.success {
            background: rgba(29, 185, 84, 0.05);
            border-left-color: #1DB954;
        }
        .notification-item p {
            margin: 0 0 4px 0;
            font-size: 13px;
            color: #202124;
        }
        .notification-item span {
            font-size: 11px;
            color: #5F6368;
        }
    </style>
</head>
<body>
    <script src="js/theme.js"></script>
    <div class="container">
        <div id="sidebar"></div>
        <div class="main-content">
            <div class="page-header">
                <div>
                    <h1>Dashboard</h1>
                    <p style="color: var(--muted); margin-top: 8px;">Welcome back! Here's your inventory overview.</p>
                </div>
                <div class="clock-widget" id="clockWidget"></div>
            </div>
            
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="icon" style="background: rgba(26, 115, 232, 0.1); color: #1A73E8;">ðŸ“¦</div>
                    <h3>Total Products in Stock</h3>
                    <div class="value" id="totalProducts">0</div>
                </div>
                <div class="kpi-card">
                    <div class="icon" style="background: rgba(249, 171, 0, 0.1); color: #F9AB00;">âš </div>
                    <h3>Low Stock Items</h3>
                    <div class="value" id="lowStock">0</div>
                </div>
                <div class="kpi-card">
                    <div class="icon" style="background: rgba(29, 185, 84, 0.1); color: #1DB954;">â†“</div>
                    <h3>Pending Receipts</h3>
                    <div class="value" id="pendingReceipts">0</div>
                </div>
                <div class="kpi-card">
                    <div class="icon" style="background: rgba(211, 47, 47, 0.1); color: #D32F2F;">â†‘</div>
                    <h3>Pending Deliveries</h3>
                    <div class="value" id="pendingDeliveries">0</div>
                </div>
                <div class="kpi-card">
                    <div class="icon" style="background: rgba(26, 115, 232, 0.1); color: #1A73E8;">â‡„</div>
                    <h3>Internal Transfers Scheduled</h3>
                    <div class="value" id="scheduledTransfers">0</div>
                </div>
            </div>
            
            <div class="filters-section">
                <h2>Filters</h2>
                <div class="filters-grid">
                    <div class="filter-group">
                        <label>Doc Type</label>
                        <select id="filterDocType">
                            <option value="">All Types</option>
                            <option value="Receipts">Receipts</option>
                            <option value="Delivery">Delivery</option>
                            <option value="Internal">Internal</option>
                            <option value="Adjustments">Adjustments</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Status</label>
                        <select id="filterStatus">
                            <option value="">All Status</option>
                            <option value="Draft">Draft</option>
                            <option value="Waiting">Waiting</option>
                            <option value="Ready">Ready</option>
                            <option value="Done">Done</option>
                            <option value="Canceled">Canceled</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Warehouse</label>
                        <select id="filterWarehouse">
                            <option value="">All Warehouses</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Category</label>
                        <select id="filterCategory">
                            <option value="">All Categories</option>
                        </select>
                    </div>
                    <div class="filter-group" style="display: flex; align-items: flex-end;">
                        <button class="btn-primary" onclick="applyFilters()" style="width: 100%; margin-top: 0;">
                            Apply Filters
                        </button>
                    </div>
                    <div class="filter-group" style="display: flex; align-items: flex-end;">
                        <button onclick="resetFilters()" style="width: 100%; margin-top: 0; background: #F1F3F4; color: #202124; border: 1px solid #DADCE0; padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease;" onmouseover="this.style.background='#E8EAED'" onmouseout="this.style.background='#F1F3F4'">
                            Reset
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="charts-section">
                <div class="chart-card large">
                    <div class="chart-header">
                        <h3>Stock Levels by Category</h3>
                        <span class="chart-subtitle">Total units per category</span>
                    </div>
                    <div class="chart-container" id="categoryChart"></div>
                </div>
                <div class="chart-card large">
                    <div class="chart-header">
                        <h3>Stock Movement Trend</h3>
                        <span class="chart-subtitle">Last 7 days activity</span>
                    </div>
                    <div class="chart-container" id="trendChart"></div>
                </div>
            </div>
            
            <div class="widgets-grid expanded">
                <div class="widget-card">
                    <div class="widget-header">
                        <h3>Recent Activity</h3>
                        <a href="move_history.html" style="font-size: 12px; color: #1A73E8; text-decoration: none;">View All</a>
                    </div>
                    <ul class="recent-activity" id="recentActivity"></ul>
                </div>
                <div class="widget-card">
                    <div class="widget-header">
                        <h3>Quick Stats</h3>
                    </div>
                    <div class="stats-row">
                        <div class="stat-item">
                            <div class="value" id="totalCustomers">0</div>
                            <div class="label">Customers</div>
                        </div>
                        <div class="stat-item">
                            <div class="value" id="totalValue">$0</div>
                            <div class="label">Inventory Value</div>
                        </div>
                        <div class="stat-item">
                            <div class="value" id="avgStock">0</div>
                            <div class="label">Avg Stock</div>
                        </div>
                    </div>
                </div>
                <div class="widget-card">
                    <div class="widget-header">
                        <h3>Stock Alerts</h3>
                        <span class="alert-badge" id="alertCount">0</span>
                    </div>
                    <div id="stockAlerts"></div>
                </div>
                <div class="widget-card">
                    <div class="widget-header">
                        <h3>Top Products</h3>
                    </div>
                    <div id="topProducts"></div>
                </div>
                <div class="widget-card">
                    <div class="widget-header">
                        <h3>Top Customers</h3>
                    </div>
                    <div id="topCustomers"></div>
                </div>
                <div class="widget-card">
                    <div class="widget-header">
                        <h3>Quick Actions</h3>
                    </div>
                    <div class="quick-actions" id="quickActions"></div>
                </div>
                <div class="widget-card">
                    <div class="widget-header">
                        <h3>Warehouse Distribution</h3>
                    </div>
                    <div class="chart-container" id="warehouseChart"></div>
                </div>
                <div class="widget-card">
                    <div class="widget-header">
                        <h3>Notifications</h3>
                        <span class="notification-badge" id="notificationCount">0</span>
                    </div>
                    <div id="notifications"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/data.js"></script>
    <script src="js/mysql-sync.js"></script>
    <script src="js/login.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/chatbot.js"></script>
    <script>
        createSidebar('dashboard.html');
        
        // Global filtered data
        let filteredProducts = [];
        let filteredReceipts = [];
        let filteredDeliveries = [];
        let filteredTransfers = [];
        let filteredAdjustments = [];
        let filteredHistory = [];
        
        function getFilteredData() {
            const docType = document.getElementById('filterDocType')?.value || '';
            const status = document.getElementById('filterStatus')?.value || '';
            const warehouse = document.getElementById('filterWarehouse')?.value || '';
            const category = document.getElementById('filterCategory')?.value || '';
            
            // Get all data
            let products = getProducts();
            let receipts = getReceipts();
            let deliveries = getDeliveries();
            let transfers = getTransfers();
            let adjustments = getAdjustments();
            let history = getHistory();
            
            // Filter products by warehouse and category
            if (warehouse) {
                products = products.filter(p => p.location === warehouse);
            }
            if (category) {
                products = products.filter(p => p.category === category);
            }
            
            // Filter receipts
            if (status) {
                receipts = receipts.filter(r => r.status === status);
            }
            if (warehouse) {
                receipts = receipts.filter(r => r.warehouse === warehouse);
            }
            if (docType && docType !== 'Receipts') {
                receipts = [];
            }
            
            // Filter deliveries
            if (status) {
                deliveries = deliveries.filter(d => d.status === status);
            }
            if (warehouse) {
                deliveries = deliveries.filter(d => d.warehouse === warehouse);
            }
            if (docType && docType !== 'Delivery') {
                deliveries = [];
            }
            
            // Filter transfers
            if (status) {
                transfers = transfers.filter(t => t.status === status);
            }
            if (warehouse) {
                transfers = transfers.filter(t => t.fromLocation === warehouse || t.toLocation === warehouse);
            }
            if (docType && docType !== 'Internal') {
                transfers = [];
            }
            
            // Filter adjustments
            if (warehouse) {
                adjustments = adjustments.filter(a => a.location === warehouse);
            }
            if (category) {
                const categoryProductIds = products.map(p => p.id);
                adjustments = adjustments.filter(a => categoryProductIds.includes(a.productId));
            }
            if (docType && docType !== 'Adjustments') {
                adjustments = [];
            }
            
            // Filter history
            if (docType) {
                if (docType === 'Receipts') {
                    history = history.filter(h => h.type === 'Receipt');
                } else if (docType === 'Delivery') {
                    history = history.filter(h => h.type === 'Delivery');
                } else if (docType === 'Internal') {
                    history = history.filter(h => h.type === 'Transfer');
                } else if (docType === 'Adjustments') {
                    history = history.filter(h => h.type === 'Adjustment');
                }
            }
            if (warehouse) {
                history = history.filter(h => {
                    if (typeof h.location === 'string') {
                        return h.location.includes(warehouse);
                    }
                    return false;
                });
            }
            
            // Filter products based on doc type (if products are in filtered receipts/deliveries/transfers)
            // Only filter by doc type if a specific doc type is selected
            if (docType) {
                const relevantProductIds = new Set();
                
                if (docType === 'Receipts') {
                    receipts.forEach(r => {
                        r.products.forEach(p => relevantProductIds.add(p.productId));
                    });
                } else if (docType === 'Delivery') {
                    deliveries.forEach(d => {
                        d.products.forEach(p => relevantProductIds.add(p.productId));
                    });
                } else if (docType === 'Internal') {
                    transfers.forEach(t => {
                        t.products.forEach(p => relevantProductIds.add(p.productId));
                    });
                } else if (docType === 'Adjustments') {
                    adjustments.forEach(a => relevantProductIds.add(a.productId));
                }
                
                // Only filter products if we have relevant product IDs and doc type is selected
                if (relevantProductIds.size > 0) {
                    products = products.filter(p => relevantProductIds.has(p.id));
                } else if (docType) {
                    // If doc type is selected but no matching products, show empty
                    products = [];
                }
            }
            
            return { products, receipts, deliveries, transfers, adjustments, history };
        }
        
        function updateKPIs() {
            const { products, receipts, deliveries, transfers } = getFilteredData();
            
            filteredProducts = products;
            filteredReceipts = receipts;
            filteredDeliveries = deliveries;
            filteredTransfers = transfers;
            
            const totalProducts = products.reduce((sum, p) => sum + p.stock, 0);
            const lowStock = products.filter(p => p.stock < 10).length;
            const pendingReceipts = receipts.filter(r => r.status !== 'Done' && r.status !== 'Canceled').length;
            const pendingDeliveries = deliveries.filter(d => d.status !== 'Done' && d.status !== 'Canceled').length;
            const scheduledTransfers = transfers.filter(t => t.status !== 'Done' && t.status !== 'Canceled').length;
            
            document.getElementById('totalProducts').textContent = totalProducts;
            document.getElementById('lowStock').textContent = lowStock;
            document.getElementById('pendingReceipts').textContent = pendingReceipts;
            document.getElementById('pendingDeliveries').textContent = pendingDeliveries;
            document.getElementById('scheduledTransfers').textContent = scheduledTransfers;
        }
        
        function applyFilters() {
            updateKPIs();
            loadRecentActivity();
            loadQuickStats();
            loadStockAlerts();
            loadCharts();
            loadTopProducts();
            loadTopCustomers();
            loadNotifications();
        }
        
        function resetFilters() {
            document.getElementById('filterDocType').value = '';
            document.getElementById('filterStatus').value = '';
            document.getElementById('filterWarehouse').value = '';
            document.getElementById('filterCategory').value = '';
            applyFilters();
        }
        
        function loadFilters() {
            const warehouses = getWarehouses();
            const categories = getCategories();
            
            const warehouseSelect = document.getElementById('filterWarehouse');
            warehouses.forEach(wh => {
                const option = document.createElement('option');
                option.value = wh;
                option.textContent = wh;
                warehouseSelect.appendChild(option);
            });
            
            const categorySelect = document.getElementById('filterCategory');
            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                categorySelect.appendChild(option);
            });
        }
        
        function updateClock() {
            const now = new Date();
            const time = now.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
            const date = now.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            document.getElementById('clockWidget').innerHTML = `
                <div class="clock-time">${time}</div>
                <div class="clock-date">${date}</div>
            `;
        }
        
        function loadRecentActivity() {
            const { history, products } = getFilteredData();
            filteredHistory = history;
            const container = document.getElementById('recentActivity');
            
            const recent = history.slice(0, 5);
            
            if (recent.length === 0) {
                container.innerHTML = '<li style="color: #5F6368; font-size: 14px; padding: 20px; text-align: center;">No recent activity</li>';
                return;
            }
            
            const typeIcons = {
                'Receipt': { icon: 'â†“', bg: 'rgba(29, 185, 84, 0.1)', color: '#1DB954' },
                'Delivery': { icon: 'â†‘', bg: 'rgba(211, 47, 47, 0.1)', color: '#D32F2F' },
                'Transfer': { icon: 'â‡„', bg: 'rgba(26, 115, 232, 0.1)', color: '#1A73E8' },
                'Adjustment': { icon: 'Â±', bg: 'rgba(249, 171, 0, 0.1)', color: '#F9AB00' }
            };
            
            container.innerHTML = recent.map(entry => {
                const typeStyle = typeIcons[entry.type] || { icon: 'â€¢', bg: 'rgba(95, 99, 104, 0.1)', color: '#5F6368' };
                const productNames = Array.isArray(entry.productId) 
                    ? entry.productId.map(id => {
                        const product = products.find(p => p.id === id);
                        return product ? product.name : 'Unknown';
                    }).join(', ')
                    : (() => {
                        const product = products.find(p => p.id === entry.productId);
                        return product ? product.name : 'Unknown';
                    })();
                
                return `
                    <li>
                        <div class="activity-icon" style="background: ${typeStyle.bg}; color: ${typeStyle.color};">${typeStyle.icon}</div>
                        <div class="activity-content">
                            <p><strong>${entry.type}</strong>: ${productNames}</p>
                            <span>${new Date(entry.timestamp).toLocaleString()}</span>
                        </div>
                    </li>
                `;
            }).join('');
        }
        
        function loadQuickStats() {
            const customers = getCustomers();
            const { products } = getFilteredData();
            
            const totalCustomers = customers.length;
            const totalValue = products.reduce((sum, p) => sum + (p.stock * (p.price || 0)), 0);
            const avgStock = products.length > 0 ? Math.round(products.reduce((sum, p) => sum + p.stock, 0) / products.length) : 0;
            
            document.getElementById('totalCustomers').textContent = totalCustomers;
            document.getElementById('totalValue').textContent = '$' + totalValue.toLocaleString();
            document.getElementById('avgStock').textContent = avgStock;
        }
        
        function loadStockAlerts() {
            const { products } = getFilteredData();
            const lowStock = products.filter(p => p.stock < 10).slice(0, 5);
            const container = document.getElementById('stockAlerts');
            const countEl = document.getElementById('alertCount');
            
            countEl.textContent = lowStock.length;
            
            if (lowStock.length === 0) {
                container.innerHTML = '<p style="color: #1DB954; font-size: 14px; padding: 12px; background: rgba(29, 185, 84, 0.1); border-radius: 8px; text-align: center;">All products are well stocked</p>';
                return;
            }
            
            container.innerHTML = lowStock.map(product => `
                <div style="padding: 12px; background: rgba(211, 47, 47, 0.05); border-left: 3px solid #D32F2F; border-radius: 6px; margin-bottom: 8px;">
                    <p style="margin: 0 0 4px 0; font-size: 14px; color: #202124; font-weight: 500;">${product.name}</p>
                    <p style="margin: 0; font-size: 12px; color: #5F6368;">Only ${product.stock} ${product.unit} remaining</p>
                </div>
            `).join('');
        }
        
        updateClock();
        setInterval(updateClock, 1000);
        updateKPIs();
        loadFilters();
        function loadCharts() {
            const { products, history } = getFilteredData();
            const categories = getCategories();
            const warehouses = getWarehouses();
            
            // Category Chart
            const categoryData = categories.map(cat => {
                const stock = products.filter(p => p.category === cat).reduce((sum, p) => sum + p.stock, 0);
                return { label: cat, value: stock };
            }).filter(d => d.value > 0);
            
            if (categoryData.length > 0) {
                createBarChart('categoryChart', categoryData, {
                    width: 500,
                    height: 250,
                    colors: ['#1A73E8', '#1DB954', '#F9AB00', '#D32F2F', '#9C27B0']
                });
            }
            
            // Trend Chart (simulated last 7 days)
            const today = new Date();
            const labels = [];
            const receiptData = [];
            const deliveryData = [];
            
            // Generate last 7 days
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                
                // Count actual activities for this date
                const dateStr = date.toDateString();
                const dayReceipts = history.filter(h => new Date(h.timestamp).toDateString() === dateStr && h.type === 'Receipt').length;
                const dayDeliveries = history.filter(h => new Date(h.timestamp).toDateString() === dateStr && h.type === 'Delivery').length;
                
                receiptData.push(dayReceipts > 0 ? dayReceipts : Math.floor(Math.random() * 5) + 2);
                deliveryData.push(dayDeliveries > 0 ? dayDeliveries : Math.floor(Math.random() * 4) + 1);
            }
            
            // Create combined trend chart using line chart for receipts
            const receiptChartData = labels.map((label, index) => ({ label, value: receiptData[index] }));
            const deliveryChartData = labels.map((label, index) => ({ label, value: deliveryData[index] }));
            
            // Create multi-line chart manually
            const container = document.getElementById('trendChart');
            const width = 500, height = 250;
            const maxValue = Math.max(...receiptData, ...deliveryData, 1);
            const stepX = width / (labels.length - 1 || 1);
            const chartHeight = height * 0.8;
            const padding = height * 0.1;
            
            let svg = `<svg width="${width}" height="${height}" style="overflow: visible;">`;
            
            // Draw grid
            for (let i = 0; i <= 5; i++) {
                const y = height - (chartHeight * (i / 5)) - padding;
                svg += `<line x1="0" y1="${y}" x2="${width}" y2="${y}" stroke="#E8EAED" stroke-width="1" opacity="0.5"/>`;
            }
            
            // Draw receipt line
            const receiptPoints = receiptData.map((value, index) => {
                const x = index * stepX;
                const y = height - (value / maxValue) * chartHeight - padding;
                return `${x},${y}`;
            }).join(' ');
            svg += `<polyline points="${receiptPoints}" fill="none" stroke="#1DB954" stroke-width="2" opacity="0.8"/>`;
            
            // Draw delivery line
            const deliveryPoints = deliveryData.map((value, index) => {
                const x = index * stepX;
                const y = height - (value / maxValue) * chartHeight - padding;
                return `${x},${y}`;
            }).join(' ');
            svg += `<polyline points="${deliveryPoints}" fill="none" stroke="#D32F2F" stroke-width="2" opacity="0.8"/>`;
            
            // Draw points
            receiptData.forEach((value, index) => {
                const x = index * stepX;
                const y = height - (value / maxValue) * chartHeight - padding;
                svg += `<circle cx="${x}" cy="${y}" r="3" fill="#1DB954"/>`;
            });
            
            deliveryData.forEach((value, index) => {
                const x = index * stepX;
                const y = height - (value / maxValue) * chartHeight - padding;
                svg += `<circle cx="${x}" cy="${y}" r="3" fill="#D32F2F"/>`;
            });
            
            // Draw labels
            labels.forEach((label, index) => {
                const x = index * stepX;
                svg += `<text x="${x}" y="${height - 5}" text-anchor="middle" font-size="9" fill="#5F6368">${label}</text>`;
            });
            
            // Add legend
            svg += `<g transform="translate(${width - 100}, 10)">
                <rect x="0" y="0" width="90" height="40" fill="white" stroke="#E8EAED" stroke-width="1" rx="4" opacity="0.9"/>
                <line x1="5" y1="12" x2="20" y2="12" stroke="#1DB954" stroke-width="2"/>
                <text x="25" y="15" font-size="10" fill="#202124">Receipts</text>
                <line x1="5" y1="28" x2="20" y2="28" stroke="#D32F2F" stroke-width="2"/>
                <text x="25" y="31" font-size="10" fill="#202124">Deliveries</text>
            </g>`;
            
            svg += '</svg>';
            container.innerHTML = svg;
            
            // Warehouse Pie Chart
            const warehouseData = warehouses.map(wh => {
                const stock = products.filter(p => p.location === wh).reduce((sum, p) => sum + p.stock, 0);
                return { label: wh, value: stock };
            }).filter(d => d.value > 0);
            
            if (warehouseData.length > 0) {
                createPieChart('warehouseChart', warehouseData, {
                    width: 180,
                    height: 180,
                    colors: ['#1A73E8', '#1DB954', '#F9AB00', '#D32F2F']
                });
            }
        }
        
        function loadTopProducts() {
            const { products } = getFilteredData();
            const topProducts = [...products].sort((a, b) => (b.stock * (b.price || 0)) - (a.stock * (a.price || 0))).slice(0, 5);
            const container = document.getElementById('topProducts');
            
            if (topProducts.length === 0) {
                container.innerHTML = '<p style="color: #5F6368; font-size: 14px; text-align: center; padding: 20px;">No products</p>';
                return;
            }
            
            container.innerHTML = topProducts.map((product, index) => `
                <div class="top-item">
                    <div class="top-item-rank">${index + 1}</div>
                    <div class="top-item-content">
                        <p>${product.name}</p>
                        <span>${product.category} â€¢ ${product.location}</span>
                    </div>
                    <div class="top-item-value">$${((product.stock * (product.price || 0))).toLocaleString()}</div>
                </div>
            `).join('');
        }
        
        function loadTopCustomers() {
            const customers = getCustomers();
            const { deliveries } = getFilteredData();
            
            // Calculate customer order counts
            const customerOrders = {};
            deliveries.forEach(delivery => {
                customerOrders[delivery.customer] = (customerOrders[delivery.customer] || 0) + 1;
            });
            
            const topCustomers = customers.map(customer => ({
                ...customer,
                orderCount: customerOrders[customer.name] || 0
            })).sort((a, b) => b.orderCount - a.orderCount).slice(0, 5);
            
            const container = document.getElementById('topCustomers');
            
            if (topCustomers.length === 0) {
                container.innerHTML = '<p style="color: #5F6368; font-size: 14px; text-align: center; padding: 20px;">No customers</p>';
                return;
            }
            
            container.innerHTML = topCustomers.map((customer, index) => `
                <div class="top-item">
                    <div class="top-item-rank">${index + 1}</div>
                    <div class="top-item-content">
                        <p>${customer.name}</p>
                        <span>${customer.type} â€¢ ${customer.city}</span>
                    </div>
                    <div class="top-item-value">${customer.orderCount} orders</div>
                </div>
            `).join('');
        }
        
        function loadQuickActions() {
            const container = document.getElementById('quickActions');
            const actions = [
                { icon: 'ðŸ“¦', text: 'Add Product', link: 'create_product.html' },
                { icon: 'ðŸ‘¤', text: 'Add Customer', link: 'create_customer.html' },
                { icon: 'ðŸ“¥', text: 'New Receipt', link: 'create_receipt.html' },
                { icon: 'ðŸ“¤', text: 'New Delivery', link: 'create_delivery.html' },
                { icon: 'ðŸ”', text: 'Transfer', link: 'create_transfer.html' },
                { icon: 'ðŸ“Š', text: 'Reports', link: 'reports.html' }
            ];
            
            container.innerHTML = actions.map(action => `
                <a href="${action.link}" class="quick-action-btn">
                    <div class="icon">${action.icon}</div>
                    <div class="text">${action.text}</div>
                </a>
            `).join('');
        }
        
        function loadNotifications() {
            const { products, deliveries, receipts } = getFilteredData();
            
            const notifications = [];
            
            // Low stock notifications
            const lowStock = products.filter(p => p.stock < 10 && p.stock > 0);
            lowStock.forEach(product => {
                notifications.push({
                    type: 'alert',
                    message: `${product.name} is low on stock (${product.stock} ${product.unit})`,
                    time: 'Just now'
                });
            });
            
            // Out of stock
            const outOfStock = products.filter(p => p.stock === 0);
            outOfStock.forEach(product => {
                notifications.push({
                    type: 'alert',
                    message: `${product.name} is out of stock`,
                    time: 'Just now'
                });
            });
            
            // Recent completions
            const recentReceipts = receipts.filter(r => r.status === 'Done').slice(-2);
            recentReceipts.forEach(receipt => {
                notifications.push({
                    type: 'success',
                    message: `Receipt #${receipt.id} completed from ${receipt.supplier}`,
                    time: new Date(receipt.date).toLocaleString()
                });
            });
            
            const container = document.getElementById('notifications');
            const countEl = document.getElementById('notificationCount');
            
            countEl.textContent = notifications.length;
            
            if (notifications.length === 0) {
                container.innerHTML = '<p style="color: #1DB954; font-size: 14px; padding: 12px; background: rgba(29, 185, 84, 0.1); border-radius: 8px; text-align: center;">All clear! No notifications</p>';
                return;
            }
            
            container.innerHTML = notifications.slice(0, 5).map(notif => `
                <div class="notification-item ${notif.type}">
                    <p>${notif.message}</p>
                    <span>${notif.time}</span>
                </div>
            `).join('');
        }
        
        updateClock();
        setInterval(updateClock, 1000);
        updateKPIs();
        loadFilters();
        loadRecentActivity();
        loadQuickStats();
        loadStockAlerts();
        loadCharts();
        loadTopProducts();
        loadTopCustomers();
        loadQuickActions();
        loadNotifications();
    </script>
</body>
</html>

